<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz DWWM Interactif</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
    
    :root { 
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.37);
      --shadow-heavy: 0 15px 35px rgba(31, 38, 135, 0.5);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.8);
      --accent-blue: #74b9ff;
      --accent-green: #00b894;
      --accent-red: #e17055;
    }

    // Afficher l'explication (corrigé pour mode solo)
    function showExplanation(explanation, isCorrect) {
      const explanationDiv = document.createElement('div');
      explanationDiv.className = `explanation ${isCorrect ? 'correct' : 'incorrect'}`;
      
      // Le HTML explanation contient déjà <h4>Explication</h4>
      explanationDiv.innerHTML = explanation;
      
      // Insérer l'explication dans la carte de question
      const questionCard = document.querySelector('.question-card');
      if (questionCard) {
        questionCard.appendChild(explanationDiv);
      }
    }

    // Afficher le bouton pour continuer
    function showContinueButton() {
      const continueDiv = document.createElement('div');
      continueDiv.style.cssText = `
        text-align: center;
        margin: 20px 0;
        animation: fadeIn 0.5s ease-out;
      `;
      
      if (currentMode === 'solo') {
        continueDiv.innerHTML = `
          <button onclick="nextQuestion()" style="font-size: 1.2em; padding: 15px 30px; background: var(--success-gradient);">
            ➡️ Question suivante
          </button>
        `;
      } else if (currentMode === 'player') {
        continueDiv.innerHTML = `
          <div style="color: var(--text-secondary); font-style: italic;">
            ⏳ En attente que l'hôte passe à la question suivante...
          </div>
        `;
      }
      
      const questionCard = document.querySelector('.question-card');
      if (questionCard) {
        questionCard.appendChild(continueDiv);
      }
    }

    // Passer à la question suivante
    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        showFinalResults();
      } else {
        showQuestion();
      }
    }
    
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body { 
      font-family: 'Space Grotesk', sans-serif; 
      background: var(--primary-gradient);
      min-height: 100vh; 
      padding: 20px; 
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
    }
    
    /* Particules animées en arrière-plan */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
      animation: backgroundShift 15s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }
    
    @keyframes backgroundShift {
      0%, 100% { 
        background-image: 
          radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
      }
      50% { 
        background-image: 
          radial-gradient(circle at 80% 20%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 20% 80%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 60% 60%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
      }
    }
    
    .container { 
      max-width: 900px; 
      margin: auto; 
      background: var(--glass-bg);
      border-radius: 24px; 
      padding: 40px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-heavy);
      text-align: center;
      position: relative;
      animation: containerFadeIn 1s ease-out;
    }
    
    @keyframes containerFadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    h1 { 
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 700;
      margin-bottom: 24px; 
      background: linear-gradient(45deg, #fff, #a8edea, #fed6e3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: none;
      animation: titleGlow 3s ease-in-out infinite alternate;
      position: relative;
    }
    
    @keyframes titleGlow {
      from { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3)); }
      to { filter: drop-shadow(0 0 30px rgba(168, 237, 234, 0.5)); }
    }
    
    .mode-selector {
      margin: 40px 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    
    .mode-btn {
      padding: 30px 25px;
      background: var(--glass-bg);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      font-size: 1.2em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      text-decoration: none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
      font-family: inherit;
    }
    
    .mode-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.6s;
    }
    
    .mode-btn:hover::before {
      left: 100%;
    }
    
    .mode-btn:hover { 
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow-heavy);
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .mode-btn:active {
      transform: translateY(-4px) scale(0.98);
    }
    
    .mode-btn:disabled {
      background: rgba(255, 255, 255, 0.05);
      cursor: not-allowed;
      transform: none;
      opacity: 0.5;
    }
    
    .mode-btn small {
      display: block;
      margin-top: 8px;
      opacity: 0.8;
      font-size: 0.9em;
      font-weight: 400;
    }
    
    .game-area {
      background: var(--glass-bg);
      border-radius: 20px;
      padding: 30px;
      margin: 25px 0;
      min-height: 500px;
      display: none;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-light);
      animation: gameAreaSlideIn 0.6s ease-out;
    }
    
    @keyframes gameAreaSlideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .question-card {
      background: rgba(255, 255, 255, 0.95);
      color: #2c3e50;
      border-radius: 20px;
      padding: 35px;
      margin: 20px 0;
      text-align: left;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
      animation: cardSlideUp 0.5s ease-out;
    }
    
    @keyframes cardSlideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .question-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--secondary-gradient);
    }
    
    .question-title {
      font-size: 1.4em;
      font-weight: 600;
      margin-bottom: 25px;
      color: #2c3e50;
      line-height: 1.4;
    }
    
    .choices {
      display: grid;
      gap: 12px;
    }
    
    .choice {
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border: 2px solid transparent;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
      font-weight: 500;
    }
    
    .choice::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(116, 185, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .choice:hover::before {
      left: 100%;
    }
    
    .choice:hover {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-color: var(--accent-blue);
      transform: translateX(8px);
      box-shadow: 0 5px 20px rgba(116, 185, 255, 0.3);
    }
    
    .choice.selected {
      background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%);
      border-color: var(--accent-blue);
      transform: translateX(8px);
      box-shadow: 0 5px 20px rgba(116, 185, 255, 0.4);
    }
    
    .choice.correct {
      background: var(--success-gradient) !important;
      border-color: var(--accent-green) !important;
      color: #ffffff !important;
      transform: scale(1.02);
      animation: correctPulse 0.6s ease-out;
    }
    
    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1.02); }
    }
    
    .choice.incorrect {
      background: var(--warning-gradient) !important;
      border-color: var(--accent-red) !important;
      color: #ffffff !important;
      animation: incorrectShake 0.5s ease-out;
    }
    
    .explanation {
      margin: 20px 0;
      padding: 20px;
      border-radius: 15px;
      font-weight: 500;
      line-height: 1.6;
      animation: explanationSlideIn 0.5s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    .explanation h4 {
      margin: 0 0 10px 0;
      color: inherit;
      font-size: 1.1em;
    }
    
    .explanation p {
      margin: 0;
      line-height: 1.6;
    }
    
    .explanation strong {
      font-weight: 600;
    }
    
    .explanation.correct {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      border: 1px solid #28a745;
      color: #155724;
    }
    
    .explanation.incorrect {
      background: linear-gradient(135deg, #f8d7da, #f1b0b7);
      border: 1px solid #dc3545;
      color: #721c24;
    }
    
    .explanation-title {
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.2em;
    }
    
    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    @keyframes explanationSlideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    button {
      background: var(--secondary-gradient);
      color: white;
      border: none;
      padding: 18px 35px;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      margin: 12px;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
      font-family: inherit;
      position: relative;
      overflow: hidden;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transition: all 0.3s;
      transform: translate(-50%, -50%);
    }
    
    button:hover::before {
      width: 300px;
      height: 300px;
    }
    
    button:hover { 
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
    }
    
    button:active {
      transform: translateY(-1px);
    }
    
    button:disabled { 
      background: linear-gradient(135deg, #6c757d, #495057);
      cursor: not-allowed; 
      transform: none;
      box-shadow: none;
    }
    
    .score-display {
      font-size: 1.4em;
      font-weight: 600;
      margin: 25px 0;
      padding: 20px;
      background: var(--glass-bg);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      animation: scoreUpdate 0.5s ease-out;
    }
    
    @keyframes scoreUpdate {
      0% { transform: scale(0.95); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .progress-bar {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      height: 12px;
      margin: 20px 0;
      overflow: hidden;
      position: relative;
    }
    
    .progress-fill {
      background: var(--success-gradient);
      height: 100%;
      width: 0%;
      transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      border-radius: 12px;
      position: relative;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: progressShimmer 2s infinite;
    }
    
    @keyframes progressShimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .final-results {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
      color: #2c3e50;
      border-radius: 20px;
      padding: 40px;
      margin: 25px 0;
      box-shadow: var(--shadow-heavy);
      animation: resultsReveal 0.8s ease-out;
    }
    
    @keyframes resultsReveal {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .intro-text {
      font-size: 1.2em;
      line-height: 1.6;
      margin: 25px 0;
      opacity: 0.9;
      font-weight: 400;
    }
    
    .feature-list {
      text-align: left;
      display: inline-block;
      margin: 30px 0;
      background: var(--glass-bg);
      padding: 25px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
    }
    
    .feature-list li {
      margin: 12px 0;
      padding-left: 15px;
      font-weight: 500;
      transition: transform 0.2s ease;
    }
    
    .feature-list li:hover {
      transform: translateX(5px);
    }
    
    .timer {
      font-size: 1.8em;
      font-weight: 700;
      color: #FFD700;
      margin: 15px 0;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
      animation: timerPulse 1s ease-in-out infinite alternate;
    }
    
    @keyframes timerPulse {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }
    
    .connection-info {
      background: var(--glass-bg);
      padding: 25px;
      border-radius: 15px;
      margin: 25px 0;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-light);
    }
    
    .qr-code {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 15px;
      margin: 25px auto;
      display: inline-block;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .players-list {
      background: var(--glass-bg);
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
    }
    
    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      margin: 8px 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      transition: all 0.3s ease;
      animation: playerJoin 0.5s ease-out;
    }
    
    @keyframes playerJoin {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .player-item:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
    }
    
    .status-indicator {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .status-connected { 
      background: var(--success-gradient);
      color: white;
      box-shadow: 0 2px 10px rgba(79, 172, 254, 0.3);
    }
    
    .status-waiting { 
      background: var(--warning-gradient);
      color: white;
      box-shadow: 0 2px 10px rgba(247, 112, 154, 0.3);
    }
    
    .status-answered { 
      background: var(--secondary-gradient);
      color: white;
      box-shadow: 0 2px 10px rgba(240, 147, 251, 0.3);
    }
    
    .firebase-setup {
      background: rgba(255, 255, 255, 0.95);
      color: #2c3e50;
      border-radius: 20px;
      padding: 30px;
      margin: 25px 0;
      text-align: left;
      box-shadow: var(--shadow-light);
      border-left: 5px solid var(--accent-blue);
    }
    
    .firebase-setup code {
      background: #f8f9fa;
      padding: 4px 8px;
      border-radius: 6px;
      font-family: 'Fira Code', monospace;
      font-size: 0.9em;
    }
    
    .firebase-setup pre {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      overflow-x: auto;
      margin: 15px 0;
      border: 1px solid #e9ecef;
    }
    
    .offline-notice {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
      border: 2px solid #ffc107;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      color: #856404;
      font-weight: 600;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 25px;
        margin: 10px;
      }
      
      .mode-selector {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .mode-btn {
        padding: 25px 20px;
        font-size: 1.1em;
      }
      
      .question-card {
        padding: 25px;
      }
      
      .choice {
        padding: 15px;
        font-size: 0.95em;
      }
      
      h1 {
        font-size: 2rem;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 20px;
      }
      
      .mode-btn {
        padding: 20px 15px;
        font-size: 1em;
      }
      
      .question-card {
        padding: 20px;
      }
      
      .choice {
        padding: 12px;
      }
      
      button {
        padding: 15px 25px;
        font-size: 1em;
      }
    }
    
    /* Animations d'entrée personnalisées */
    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in-left {
      animation: slideInLeft 0.5s ease-out forwards;
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    /* Effet de focus amélioré */
    input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(116, 185, 255, 0.3);
      border-color: var(--accent-blue);
    }
    
    /* Scrollbar personnalisée */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--secondary-gradient);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #f093fb 20%, #f5576c 80%);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎯 Quiz DWWM Interactif</h1>
    
    <!-- Configuration Firebase -->
    <div class="firebase-setup" id="firebaseSetup" style="display:none;">
      <h3>🔧 Configuration Firebase requise</h3>
      <p>Pour activer le mode multijoueur, configurez Firebase :</p>
      
      <ol style="margin: 15px 0;">
        <li>Allez sur <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
        <li>Créez un nouveau projet ou utilisez un existant</li>
        <li>Activez "Realtime Database" avec les règles de test</li>
        <li>Copiez la configuration et remplacez les valeurs ci-dessous</li>
      </ol>
      
      <pre><code>// Remplacez ces valeurs dans le script
const firebaseConfig = {
  apiKey: "AIzaSyCOegG19Z-G04jRXBA3aXUSLTrHrPtEwbQ",
  authDomain: "quiz-4321f.firebaseapp.com",
  databaseURL: "https://quiz-4321f-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "quiz-4321f",
};</code></pre>
      
      <button onclick="document.getElementById('firebaseSetup').style.display='none'">✅ J'ai configuré Firebase</button>
    </div>
    
    <!-- Menu principal -->
    <div id="mainMenu" class="fade-in">
      <div class="intro-text">
        <strong>🚀 Quiz professionnel pour la formation DWWM</strong><br>
        Testez vos connaissances en développement web avec style !
      </div>
      
      <div class="offline-notice" id="offlineNotice" style="display:none;">
        ⚠️ Mode multijoueur indisponible (Firebase non configuré). Le mode solo fonctionne normalement.
      </div>
      
      <div class="feature-list slide-in-left">
        <ul>
          <li>✅ <strong>Mode Solo</strong> - Entraînement personnel</li>
          <li>🎮 <strong>Mode Multijoueur</strong> - Synchronisation temps réel</li>
          <li>⚡ <strong>Questions mélangées</strong> - Jamais le même quiz</li>
          <li>🏆 <strong>Scores et classements</strong> - Compétition amicale</li>
          <li>📱 <strong>Mobile-friendly</strong> - Design responsif</li>
        </ul>
      </div>
      
      <div class="mode-selector">
        <button class="mode-btn" onclick="startSoloMode()">
          ⚡ Mode Solo
          <small>Test rapide individuel</small>
        </button>
        
        <button class="mode-btn" id="hostBtn" onclick="startHostMode()">
          🖥️ Mode Hôte
          <small>Créer une partie multijoueur</small>
        </button>
        
        <button class="mode-btn" id="joinBtn" onclick="showJoinInterface()">
          📱 Rejoindre
          <small>Participer à une partie</small>
        </button>
      </div>
    </div>
    
    <!-- Zone de jeu -->
    <div class="game-area" id="gameArea">
      <div class="score-display" id="scoreDisplay"></div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="timer" id="timer"></div>
      <div id="questionContainer"></div>
    </div>
    
    <!-- Section multijoueur -->
    <div class="connection-info" id="connectionInfo" style="display:none;">
      <div id="roomCode"></div>
      <div class="qr-code" id="qrCode" style="display:none;"></div>
      <div id="playersList"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ⚠️ CONFIGURATION FIREBASE - VOS VRAIES VALEURS
    const firebaseConfig = {
      apiKey: "AIzaSyCOegG19Z-G04jRXBA3aXUSLTrHrPtEwbQ",
      authDomain: "quiz-4321f.firebaseapp.com",
      databaseURL: "https://quiz-4321f-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "quiz-4321f"
    };

    // Variables globales
    let firebaseEnabled = false;
    let database = null;
    let currentMode = '';
    let currentQuestionIndex = 0;
    let score = 0;
    let questions = [];
    let selectedChoices = [];
    let hasAnswered = false;
    let timeLeft = 30;
    let timer = null;
    let roomCode = '';
    let playerName = '';
    let roomRef = null;
    let playersRef = null;

    // Questions DWWM - Format JSON exact
    const questionsBySubject = [
      {
        "id": 1,
        "type": "Développement front-end",
        "title": "Quel langage est principalement utilisé pour le développement web côté client ?",
        "choices": ["PHP", "JavaScript", "Python", "Java"],
        "answer": [1],
        "explanation": "<h4>Explication</h4><p>JavaScript est LE langage du côté client (navigateur). Il permet d'ajouter de l'interactivité, manipuler le DOM, gérer les événements utilisateur et créer des applications web dynamiques. PHP s'exécute côté serveur, pas dans le navigateur.</p>"
      },
      {
        "id": 2,
        "type": "Développement front-end",
        "title": "Quels sont les piliers du développement web moderne ?",
        "choices": ["HTML", "CSS", "JavaScript", "Flash"],
        "answer": [0, 1, 2],
        "explanation": "<h4>Explication</h4><p>Les 3 piliers du web sont : <strong>HTML</strong> (structure et contenu), <strong>CSS</strong> (présentation et style), <strong>JavaScript</strong> (interactivité et comportement). Flash est obsolète depuis 2020 et n'est plus supporté par les navigateurs modernes.</p>"
      },
      {
        "id": 3,
        "type": "Développement front-end",
        "title": "Que signifie CSS ?",
        "choices": ["Computer Style Sheets", "Cascading Style Sheets", "Creative Style Sheets", "Colorful Style Sheets"],
        "answer": [1],
        "explanation": "<h4>Explication</h4><p>CSS signifie <strong>'Cascading Style Sheets'</strong> (Feuilles de style en cascade). Le terme 'cascading' fait référence au système de priorité et d'héritage des styles, permettant à plusieurs règles de s'appliquer en cascade sur un même élément.</p>"
      },
      {
        "id": 4,
        "type": "Développement front-end",
        "title": "Quels frameworks JavaScript sont populaires ?",
        "choices": ["React", "Vue.js", "Angular", "jQuery"],
        "answer": [0, 1, 2],
        "explanation": "<h4>Explication</h4><p><strong>React</strong> (Facebook), <strong>Vue.js</strong> et <strong>Angular</strong> sont les 3 frameworks/librairies JavaScript modernes les plus populaires pour créer des applications web. jQuery, bien qu'encore utilisé, est considéré comme moins moderne face à ces solutions.</p>"
      },
      {
        "id": 5,
        "type": "Conception et base de données",
        "title": "Quel protocole est utilisé pour les communications web sécurisées ?",
        "choices": ["HTTP", "HTTPS", "FTP", "SSH"],
        "answer": [1],
        "explanation": "<h4>Explication</h4><p><strong>HTTPS</strong> (HTTP Secure) chiffre les données échangées entre le navigateur et le serveur grâce au SSL/TLS. Aujourd'hui obligatoire pour la plupart des sites, il protège contre l'interception et la modification des données.</p>"
      },
      {
        "id": 6,
        "type": "Développement front-end",
        "title": "Que signifie HTML ?",
        "choices": ["Hypertext Markup Language", "High Tech Modern Language", "Home Tool Markup Language", "Hypertext Machine Language"],
        "answer": [0],
        "explanation": "<h4>Explication</h4><p>HTML signifie <strong>'HyperText Markup Language'</strong>. C'est un langage de balisage (markup) qui structure le contenu web avec des éléments (balises). HyperText fait référence aux liens qui connectent les pages entre elles.</p>"
      },
      {
        "id": 7,
        "type": "Développement front-end",
        "title": "Quels sont les types de données primitifs en JavaScript ?",
        "choices": ["string", "number", "boolean", "object"],
        "answer": [0, 1, 2],
        "explanation": "<h4>Explication</h4><p>Les types primitifs en JavaScript sont : <strong>string</strong> (texte), <strong>number</strong> (nombres), <strong>boolean</strong> (vrai/faux), undefined, null, symbol et bigint. <strong>'object'</strong> n'est PAS un type primitif mais un type complexe qui peut contenir plusieurs valeurs.</p>"
      },
      {
        "id": 8,
        "type": "Le projet et les méthodes",
        "title": "Quelles sont les trois phases principales de la méthode Merise ?",
        "choices": [
          "Planification, exécution, clôture",
          "Analyse, conception, réalisation",
          "Définition, développement, maintenance",
          "Spécification, validation, déploiement"
        ],
        "answer": [1],
        "explanation": "<h4>Explication</h4><p>Merise se divise en trois phases : analyse des besoins et modélisation des données, conception détaillée, puis réalisation et implémentation.</p>"
      },
      {
        "id": 9,
        "type": "Développement back-end",
        "title": "Quels outils sont essentiels pour un développeur web ?",
        "choices": ["Éditeur de code", "Navigateur", "Serveur local", "Calculatrice"],
        "answer": [0, 1, 2],
        "explanation": "<h4>Explication</h4><p>Trilogie indispensable : <strong>Éditeur de code</strong> (VS Code, WebStorm...), <strong>Navigateur</strong> avec outils dev (Chrome DevTools, Firefox DevTools), <strong>Serveur local</strong> pour tester (XAMPP, Node.js...). Une calculatrice n'est pas spécifique au développement web.</p>"
      },
      {
        "id": 10,
        "type": "Développement back-end",
        "title": "Que permet de faire PHP ?",
        "choices": ["Développement côté serveur", "Stylisation des pages", "Animation des éléments", "Gestion de base de données"],
        "answer": [0, 3],
        "explanation": "<h4>Explication</h4><p><strong>PHP</strong> est un langage côté serveur qui génère du HTML dynamique et interagit avec les bases de données (MySQL, PostgreSQL...). Il ne peut pas styliser (c'est CSS) ni animer directement (c'est CSS/JavaScript côté client).</p>"
      },
      {
        "id": 11,
        "type": "Le projet et les méthodes",
        "title": "Quelle architecture est organisée en couches horizontales typiquement nommées IHM, BO, DAL, BLL ?",
        "choices": [
          "Architecture événementielle",
          "Architecture microservices",
          "Architecture modulaire",
          "Architecture en couches"
        ],
        "answer": [3],
        "explanation": "<h4>Explication</h4><p>L'architecture en couches divise le système en niveaux (présentation, logique métier, accès aux données, etc.) pour séparer les responsabilités.</p>"
      }
    ];
    
    // Éléments DOM
    const mainMenu = document.getElementById('mainMenu');
    const gameArea = document.getElementById('gameArea');
    const questionContainer = document.getElementById('questionContainer');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const progressFill = document.getElementById('progressFill');
    const timerDisplay = document.getElementById('timer');
    const connectionInfo = document.getElementById('connectionInfo');

    // Initialisation Firebase
    function initializeFirebase() {
      try {
        if (firebaseConfig.apiKey === "demo-api-key") {
          throw new Error("Configuration demo détectée");
        }
        
        firebase.initializeApp(firebaseConfig);
        database = firebase.database();
        firebaseEnabled = true;
        
        console.log("✅ Firebase initialisé avec succès");
        document.getElementById('offlineNotice').style.display = 'none';
        
      } catch (error) {
        console.warn("⚠️ Firebase non configuré:", error.message);
        firebaseEnabled = false;
        
        // Afficher le message d'aide
        document.getElementById('firebaseSetup').style.display = 'block';
        document.getElementById('offlineNotice').style.display = 'block';
        
        // Désactiver les boutons multijoueur
        document.getElementById('hostBtn').disabled = true;
        document.getElementById('joinBtn').disabled = true;
        document.getElementById('hostBtn').innerHTML = '🖥️ Mode Hôte<br><small>Firebase requis</small>';
        document.getElementById('joinBtn').innerHTML = '📱 Rejoindre<br><small>Firebase requis</small>';
      }
    }

    // Mode Solo (fonctionne toujours)
    function startSoloMode() {
      currentMode = 'solo';
      animateTransition(() => {
        mainMenu.style.display = 'none';
        gameArea.style.display = 'block';
        
        questions = shuffleArray([...questionsBySubject]).slice(0, 5);
        currentQuestionIndex = 0;
        score = 0;
        
        showQuestion();
      });
    }

    // Animation de transition
    function animateTransition(callback) {
      const container = document.querySelector('.container');
      container.style.transform = 'scale(0.95)';
      container.style.opacity = '0.7';
      
      setTimeout(() => {
        callback();
        container.style.transform = 'scale(1)';
        container.style.opacity = '1';
      }, 200);
    }

    // Mode Hôte (Firebase requis)
    function startHostMode() {
      if (!firebaseEnabled) {
        showNotification('❌ Firebase n\'est pas configuré. Le mode multijoueur est indisponible.', 'error');
        return;
      }
      
      const hostName = prompt('Entrez votre nom (hôte):') || 'Hôte';
      roomCode = generateRoomCode();
      
      currentMode = 'host';
      animateTransition(() => {
        mainMenu.style.display = 'none';
        gameArea.style.display = 'block';
        connectionInfo.style.display = 'block';
        
        // Créer la partie dans Firebase
        createFirebaseRoom(hostName);
        
        document.getElementById('roomCode').innerHTML = `
          <h3>🏠 Vous êtes l'hôte (${hostName})</h3>
          <div style="font-size: 1.5em; margin: 15px 0; color: #FFD700;">
            Code de partie: <strong>${roomCode}</strong>
          </div>
          <p>Partagez ce code avec les joueurs !</p>
          <div style="margin: 20px 0;">
            <button onclick="startQuizAsHost()" style="font-size: 1.2em; padding: 15px 30px; background: linear-gradient(135deg, #28a745, #20c997);">
              🚀 Démarrer le Quiz
            </button>
          </div>
        `;
        
        const url = `${window.location.origin}${window.location.pathname}?join=${roomCode}`;
        document.getElementById('qrCode').innerHTML = `
          <div style="color: #333; padding: 10px;">
            <strong>URL à partager :</strong><br>
            <small style="word-break: break-all;">${url}</small><br>
            <button onclick="copyToClipboard('${url}')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.9em; background: var(--accent-blue);">
              📋 Copier l'URL
            </button>
          </div>
        `;
        document.getElementById('qrCode').style.display = 'block';
        
        questionContainer.innerHTML = `
          <div style="text-align: center; font-size: 1.3em; padding: 40px;">
            👥 <strong>En attente des joueurs...</strong><br><br>
            <div style="margin: 20px 0;">
              Les joueurs peuvent rejoindre avec le code: <strong style="color: #FFD700;">${roomCode}</strong>
            </div>
            <div style="font-size: 0.9em; opacity: 0.8;">
              💡 Cliquez sur "Démarrer le Quiz" quand tout le monde est prêt !
            </div>
          </div>
        `;
        
        // Initialiser les questions
        questions = shuffleArray([...questionsBySubject]).slice(0, 5);
        currentQuestionIndex = 0;
        score = 0;
        
        // Écouter les changements de joueurs
        listenToPlayers();
      });
    }

    // Notification système
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${type === 'error' ? 'var(--warning-gradient)' : 'var(--success-gradient)'};
        color: white;
        border-radius: 10px;
        box-shadow: var(--shadow-light);
        z-index: 1000;
        animation: slideInRight 0.3s ease-out;
        max-width: 300px;
        font-weight: 500;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Ajouter les animations pour les notifications
    const notificationStyles = document.createElement('style');
    notificationStyles.textContent = `
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(notificationStyles);

    // Interface pour rejoindre une partie
    function showJoinInterface() {
      if (!firebaseEnabled) {
        showNotification('❌ Firebase n\'est pas configuré. Le mode multijoueur est indisponible.', 'error');
        return;
      }
      
      animateTransition(() => {
        mainMenu.style.display = 'none';
        gameArea.style.display = 'block';
        
        questionContainer.innerHTML = `
          <div class="question-card" style="text-align: center;">
            <div class="question-title">🎮 Rejoindre une partie</div>
            <div style="margin: 20px 0;">
              <input type="text" id="joinRoomCode" placeholder="Code de la partie" 
                     style="padding: 15px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 10px; margin: 10px; width: 200px; text-align: center; text-transform: uppercase; background: rgba(255,255,255,0.9);">
            </div>
            <div style="margin: 20px 0;">
              <input type="text" id="playerNameInput" placeholder="Votre nom" 
                     style="padding: 15px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 10px; margin: 10px; width: 200px; text-align: center; background: rgba(255,255,255,0.9);">
            </div>
            <div style="margin: 20px 0;">
              <button onclick="attemptJoinRoom()" style="font-size: 1.2em; padding: 15px 30px; background: linear-gradient(135deg, #28a745, #20c997);">
                🚪 Rejoindre la partie
              </button>
              <button onclick="goHome()" style="font-size: 1.2em; padding: 15px 30px; background: linear-gradient(135deg, #6c757d, #495057);">
                🏠 Retour
              </button>
            </div>
            <div id="joinError" style="color: #e17055; margin: 10px 0; font-weight: bold;"></div>
          </div>
        `;
        
        // Auto-remplir si on vient d'une URL
        const urlParams = new URLSearchParams(window.location.search);
        const joinCode = urlParams.get('join');
        if (joinCode) {
          document.getElementById('joinRoomCode').value = joinCode;
        }
      });
    }

    // Tentative de rejoindre une partie
    async function attemptJoinRoom() {
      const code = document.getElementById('joinRoomCode').value.toUpperCase().trim();
      const name = document.getElementById('playerNameInput').value.trim();
      const errorDiv = document.getElementById('joinError');
      
      if (!code) {
        errorDiv.textContent = '❌ Veuillez entrer un code de partie';
        return;
      }
      
      if (!name) {
        errorDiv.textContent = '❌ Veuillez entrer votre nom';
        return;
      }
      
      try {
        // Vérifier si la partie existe
        const roomSnapshot = await database.ref(`rooms/${code}`).once('value');
        
        if (!roomSnapshot.exists()) {
          errorDiv.textContent = '❌ Code de partie invalide';
          return;
        }
        
        const roomData = roomSnapshot.val();
        
        if (roomData.status !== 'waiting') {
          errorDiv.textContent = '❌ Cette partie a déjà commencé ou est terminée';
          return;
        }
        
        // Rejoindre la partie
        await joinFirebaseRoom(code, name);
        startPlayerMode(code, name);
        
      } catch (error) {
        console.error('Erreur lors de la connexion:', error);
        errorDiv.textContent = '❌ Erreur de connexion';
      }
    }

    // Mode Joueur
    function startPlayerMode(code, name) {
      currentMode = 'player';
      roomCode = code;
      playerName = name;
      
      connectionInfo.style.display = 'block';
      
      document.getElementById('roomCode').innerHTML = `
        <h3>📱 Joueur: ${name}</h3>
        <div>Partie: <strong>${roomCode}</strong></div>
        <p>✅ Connexion réussie !</p>
      `;
      
      questionContainer.innerHTML = `
        <div style="text-align: center; font-size: 1.3em; padding: 40px;">
          ⏳ <strong>En attente de l'hôte...</strong><br><br>
          <div style="margin: 20px 0;">
            L'hôte va démarrer le quiz quand tout le monde sera prêt
          </div>
          <div style="font-size: 0.9em; opacity: 0.8;">
            💡 Restez sur cette page, le quiz commencera automatiquement !
          </div>
        </div>
      `;
      
      // Écouter les changements de la partie
      listenToRoomChanges();
      listenToPlayers();
    }

    // Fonctions Firebase
    function generateRoomCode() {
      return Math.random().toString(36).substring(2, 8).toUpperCase();
    }

    async function createFirebaseRoom(hostName) {
      roomRef = database.ref(`rooms/${roomCode}`);
      playersRef = database.ref(`rooms/${roomCode}/players`);
      
      await roomRef.set({
        hostName: hostName,
        status: 'waiting',
        currentQuestion: 0,
        questions: questions,
        created: firebase.database.ServerValue.TIMESTAMP
      });
    }

    async function joinFirebaseRoom(code, name) {
      roomCode = code;
      playerName = name;
      roomRef = database.ref(`rooms/${roomCode}`);
      playersRef = database.ref(`rooms/${roomCode}/players`);
      
      await playersRef.child(name).set({
        name: name,
        score: 0,
        status: 'connected',
        answers: {},
        joined: firebase.database.ServerValue.TIMESTAMP
      });
    }

    function listenToRoomChanges() {
      if (!roomRef) return;
      
      roomRef.on('value', (snapshot) => {
        const roomData = snapshot.val();
        if (!roomData) return;
        
        // Synchroniser l'état du quiz
        if (roomData.status === 'playing' && currentMode === 'player') {
          if (currentQuestionIndex === 0 && !hasAnswered) {
            document.getElementById('roomCode').innerHTML = `
              <h3>📱 Quiz démarré</h3>
              <div>Partie: <strong>${roomCode}</strong></div>
              <p>🎯 Répondez aux questions !</p>
            `;
            questions = roomData.questions;
            showQuestion();
          }
          
          // Vérifier si l'hôte a changé de question
          if (roomData.currentQuestion !== currentQuestionIndex) {
            currentQuestionIndex = roomData.currentQuestion;
            if (currentQuestionIndex < questions.length) {
              showQuestion();
            } else {
              showFinalResults();
            }
          }
        }
        
        if (roomData.status === 'finished') {
          showFinalResults();
        }
      });
    }

    function listenToPlayers() {
      if (!playersRef) return;
      
      playersRef.on('value', (snapshot) => {
        const players = snapshot.val() || {};
        updatePlayersDisplay(players);
      });
    }

    // Démarrer le quiz (appelé par l'hôte)
    async function startQuizAsHost() {
      await roomRef.update({ 
        status: 'playing',
        questions: questions
      });
      
      document.getElementById('roomCode').innerHTML = `
        <h3>🏠 Quiz en cours</h3>
        <div>Partie: <strong>${roomCode}</strong></div>
        <p>🎯 Vous contrôlez le quiz</p>
      `;
      
      showQuestion();
    }

    // Question suivante (contrôlée par l'hôte)
    async function nextQuestionAsHost() {
      currentQuestionIndex++;
      await roomRef.update({ currentQuestion: currentQuestionIndex });
      if (currentQuestionIndex >= questions.length) {
        await roomRef.update({ status: 'finished' });
        showFinalResults();
      } else {
        showQuestion();
      }
    }

    // Terminer le quiz manuellement (hôte)
    async function endQuizAsHost() {
      if (confirm('Êtes-vous sûr de vouloir terminer le quiz maintenant ?')) {
        currentQuestionIndex = questions.length;
        await roomRef.update({ 
          currentQuestion: currentQuestionIndex,
          status: 'finished'
        });
        showFinalResults();
      }
    }

    // Mettre à jour l'affichage des joueurs
    function updatePlayersDisplay(players) {
      const playersListDiv = document.getElementById('playersList');
      if (!playersListDiv) return;
      
      const playersList = Object.values(players || {});
      
      if (playersList.length === 0) {
        playersListDiv.innerHTML = `
          <div class="players-list">
            <h4>👥 Joueurs connectés (0)</h4>
            <p style="opacity: 0.7;">Aucun joueur pour le moment...</p>
          </div>
        `;
        return;
      }
      
      let html = `
        <div class="players-list">
          <h4>👥 Joueurs connectés (${playersList.length})</h4>
      `;
      
      playersList.forEach(player => {
        let statusClass = 'status-connected';
        let statusText = 'Connecté';
        
        if (currentMode === 'host') {
          const hasAnsweredCurrent = player.answers && player.answers[currentQuestionIndex];
          statusClass = hasAnsweredCurrent ? 'status-answered' : 'status-waiting';
          statusText = hasAnsweredCurrent ? 'Répondu' : 'En cours...';
        }
        
        html += `
          <div class="player-item">
            <span>🎮 ${player.name}</span>
            <span class="status-indicator ${statusClass}">${statusText}</span>
          </div>
        `;
      });
      
      html += '</div>';
      playersListDiv.innerHTML = html;
    }

    // Afficher une question
    function showQuestion() {
      if (currentQuestionIndex >= questions.length) {
        showFinalResults();
        return;
      }
      
      const question = questions[currentQuestionIndex];
      hasAnswered = false;
      selectedChoices = [];
      
      let html = '';
      
      if (currentMode === 'host') {
        // Vue hôte - contrôle le quiz
        html = `
          <div class="question-card">
            <div style="font-size: 0.9em; color: #666; margin-bottom: 10px; font-weight: 500;">
              📂 ${question.type}
            </div>
            <div class="question-title">
              👑 Question ${currentQuestionIndex + 1}/${questions.length}: ${question.title}
            </div>
            <div style="margin: 20px 0; padding: 15px; background: rgba(0,200,0,0.1); border-radius: 10px;">
              <strong>✅ Réponses correctes :</strong><br>
        `;
        
        question.choices.forEach((choice, i) => {
          const isCorrect = question.answer.includes(i);
          html += `
            <div style="margin: 8px 0; padding: 10px; background: ${isCorrect ? '#c8e6c9' : '#f5f5f5'}; border-radius: 5px;">
              ${isCorrect ? '✅' : '◯'} ${choice}
            </div>
          `;
        });
        
        html += `
            </div>
            <div style="text-align: center; margin: 20px 0;">
              <button onclick="nextQuestionAsHost()" style="font-size: 1.2em; padding: 15px 30px; background: var(--success-gradient); margin: 5px;">
                ➡️ Question suivante
              </button>
              <button onclick="endQuizAsHost()" style="font-size: 1.2em; padding: 15px 30px; background: var(--warning-gradient); margin: 5px;">
                🏁 Terminer le quiz
              </button>
            </div>
            <div style="font-size: 0.9em; opacity: 0.7; text-align: center;">
              💡 Les joueurs voient cette question et l'explication après avoir répondu
            </div>
          </div>
        `;
        
      } else {
        // Vue joueur/solo - peut répondre
        timeLeft = 30;
        startTimer();
        
        html = `
          <div class="question-card">
            <div style="font-size: 0.9em; color: #666; margin-bottom: 10px; font-weight: 500;">
              📂 ${question.type}
            </div>
            <div class="question-title">
              Question ${currentQuestionIndex + 1}/${questions.length}: ${question.title}
            </div>
            <div class="choices">
        `;
        
        question.choices.forEach((choice, i) => {
          html += `
            <div class="choice" onclick="selectChoice(${i})" data-choice="${i}">
              ${choice}
            </div>
          `;
        });
        
        html += `
            </div>
            <button onclick="submitAnswer()" id="submitBtn">📝 Valider ma réponse</button>
          </div>
        `;
      }
      
      questionContainer.innerHTML = html;
      updateScore();
      updateProgress();
    }

    // Sélectionner une réponse
    function selectChoice(choiceIndex) {
      if (hasAnswered) return;
      
      const choice = document.querySelector(`[data-choice="${choiceIndex}"]`);
      
      if (choice.classList.contains('selected')) {
        choice.classList.remove('selected');
        selectedChoices = selectedChoices.filter(i => i !== choiceIndex);
      } else {
        choice.classList.add('selected');
        selectedChoices.push(choiceIndex);
      }
    }

    // Soumettre la réponse
    async function submitAnswer() {
      if (hasAnswered || selectedChoices.length === 0) {
        if (selectedChoices.length === 0) {
          showNotification('Veuillez sélectionner au moins une réponse !', 'error');
        }
        return;
      }
      
      hasAnswered = true;
      const currentQuestion = questions[currentQuestionIndex];
      
      // Arrêter le timer dès que la réponse est soumise
      clearInterval(timer);
      timerDisplay.textContent = '';
      
      // Vérifier la réponse
      const isCorrect = JSON.stringify(selectedChoices.sort()) === JSON.stringify(currentQuestion.answer.sort());
      if (isCorrect) score++;
      
      // Enregistrer la réponse du joueur dans Firebase
      if (currentMode === 'player' && playersRef) {
        try {
          await playersRef.child(`${playerName}/answers/${currentQuestionIndex}`).set({
            selected: selectedChoices,
            correct: isCorrect,
            timestamp: firebase.database.ServerValue.TIMESTAMP
          });
          
          await playersRef.child(`${playerName}/score`).set(score);
        } catch (error) {
          console.error('Erreur lors de l\'enregistrement:', error);
        }
      }
      
      // Afficher le feedback
      document.querySelectorAll('.choice').forEach((choice, i) => {
        const isCorrectAnswer = currentQuestion.answer.includes(i);
        const isSelected = selectedChoices.includes(i);
        
        choice.style.pointerEvents = 'none';
        
        if (isCorrectAnswer) {
          choice.classList.add('correct');
        } else if (isSelected) {
          choice.classList.add('incorrect');
        }
      });
      
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('submitBtn').textContent = isCorrect ? '✅ Correct !' : '❌ Incorrect';
      
      // Afficher l'explication dans tous les modes
      setTimeout(() => {
        showExplanation(currentQuestion.explanation, isCorrect);
        
        // Afficher le bouton "Continuer" après l'explication
        setTimeout(() => {
          showContinueButton();
        }, 2000);
      }, 1000);
    }

    // Timer
    function startTimer() {
      if (currentMode === 'host') {
        timerDisplay.textContent = '';
        return;
      }
      
      // Réinitialiser les styles du timer
      timerDisplay.style.color = '#FFD700';
      timerDisplay.style.animation = 'timerPulse 3s ease-in-out infinite alternate';
      
      timer = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `⏱️ ${timeLeft}s`;
        
        if (timeLeft <= 10) {
          timerDisplay.style.color = '#ff6b6b';
          timerDisplay.style.animation = 'timerPulse 0.5s ease-in-out infinite alternate';
        }
        
        if (timeLeft <= 0) {
          clearInterval(timer);
          if (!hasAnswered) {
            submitAnswer();
          }
        }
      }, 1000);
    }

    // Mise à jour du score
    function updateScore() {
      if (currentMode === 'host') {
        scoreDisplay.textContent = `👑 Hôte - Question ${currentQuestionIndex + 1}/${questions.length}`;
      } else {
        scoreDisplay.textContent = `Score: ${score}/${currentQuestionIndex} | Question ${currentQuestionIndex + 1}/${questions.length}`;
      }
      
      // Animation du score
      scoreDisplay.style.animation = 'scoreUpdate 0.5s ease-out';
    }

    // Mise à jour de la progression
    function updateProgress() {
      const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
      progressFill.style.width = progress + '%';
    }

    // Résultats finaux
    async function showFinalResults() {
      clearInterval(timer);
      timerDisplay.textContent = '';
      
      let html = '';
      
      if (currentMode === 'host') {
        // Vue hôte - résultats globaux
        let players = {};
        
        if (playersRef) {
          try {
            const snapshot = await playersRef.once('value');
            players = snapshot.val() || {};
          } catch (error) {
            console.error('Erreur lors de la récupération des scores:', error);
          }
        }
        
        const playersList = Object.values(players);
        
        html = `
          <div class="final-results">
            <h2>🏆 Quiz terminé !</h2>
            <div style="font-size: 1.5em; margin: 20px 0;">
              👑 Vous avez animé le quiz avec succès !
            </div>
            <div style="font-size: 1.2em; margin: 15px 0;">
              ${questions.length} questions présentées à ${playersList.length} joueur(s)
            </div>
        `;
        
        if (playersList.length > 0) {
          // Classement des joueurs
          playersList.sort((a, b) => (b.score || 0) - (a.score || 0));
          
          html += `
            <div style="margin: 20px 0;">
              <h3>🏅 Classement final :</h3>
              <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin: 15px 0;">
          `;
          
          playersList.forEach((player, index) => {
            const trophy = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '🏅';
            const percentage = Math.round(((player.score || 0) / questions.length) * 100);
            
            html += `
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; margin: 8px 0; background: rgba(255,255,255,0.1); border-radius: 12px; animation: playerJoin 0.5s ease-out;">
                <span style="font-size: 1.1em;">${trophy} ${player.name}</span>
                <span style="font-weight: bold; font-size: 1.1em;">${player.score || 0}/${questions.length} (${percentage}%)</span>
              </div>
            `;
          });
          
          html += '</div></div>';
        }
        
        html += `
            <button onclick="restart()" style="font-size: 1.2em; padding: 15px 30px;">
              🔄 Nouveau quiz
            </button>
            <button onclick="goHome()" style="font-size: 1.2em; padding: 15px 30px; background: linear-gradient(135deg, #6c757d, #495057);">
              🏠 Menu principal
            </button>
          </div>
        `;
        
      } else {
        // Vue joueur/solo - score personnel
        const percentage = Math.round((score / questions.length) * 100);
        
        let performance = '';
        let emoji = '';
        if (percentage >= 80) { performance = 'Excellent !'; emoji = '🏆'; }
        else if (percentage >= 60) { performance = 'Bien joué !'; emoji = '👏'; }
        else if (percentage >= 40) { performance = 'À retravailler'; emoji = '📚'; }
        else { performance = 'Continuez vos efforts !'; emoji = '💪'; }
        
        html = `
          <div class="final-results">
            <h2>🎯 Quiz terminé !</h2>
            <div style="font-size: 2.5em; margin: 25px 0; font-weight: 700;">
              ${score}/${questions.length}
            </div>
            <div style="font-size: 1.8em; margin: 20px 0; font-weight: 600;">
              ${percentage}% de réussite
            </div>
            <div style="font-size: 1.5em; margin: 20px 0; font-weight: 500;">
              ${emoji} ${performance}
            </div>
            <button onclick="restart()" style="font-size: 1.2em; padding: 15px 30px;">
              🔄 Refaire un quiz
            </button>
            <button onclick="goHome()" style="font-size: 1.2em; padding: 15px 30px; background: linear-gradient(135deg, #6c757d, #495057);">
              🏠 Menu principal
            </button>
          </div>
        `;
      }
      
      questionContainer.innerHTML = html;
    }

    // Redémarrer
    function restart() {
      // Nettoyer les références Firebase
      if (roomRef) {
        roomRef.off();
        roomRef = null;
      }
      if (playersRef) {
        playersRef.off();
        playersRef = null;
      }
      
      if (currentMode === 'solo') {
        startSoloMode();
      } else if (currentMode === 'host') {
        startHostMode();
      } else {
        showJoinInterface();
      }
    }

    // Retour au menu
    function goHome() {
      // Nettoyer les références Firebase
      if (roomRef) {
        roomRef.off();
        roomRef = null;
      }
      if (playersRef) {
        playersRef.off();
        playersRef = null;
      }
      
      animateTransition(() => {
        gameArea.style.display = 'none';
        connectionInfo.style.display = 'none';
        mainMenu.style.display = 'block';
        clearInterval(timer);
      });
    }

    // Utilitaires
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showNotification('URL copiée dans le presse-papier !', 'success');
      }).catch(() => {
        prompt('Copiez cette URL:', text);
      });
    }

    // Auto-join via URL
    window.addEventListener('load', () => {
      initializeFirebase();
      
      const urlParams = new URLSearchParams(window.location.search);
      const joinCode = urlParams.get('join');
      if (joinCode && firebaseEnabled) {
        setTimeout(() => showJoinInterface(), 1000);
      }
    });

    // Nettoyage automatique des anciennes parties (toutes les 24h)
    if (firebaseEnabled) {
      setInterval(() => {
        const cutoff = Date.now() - (24 * 60 * 60 * 1000); // 24 heures
        database.ref('rooms').orderByChild('created').endAt(cutoff).once('value')
          .then(snapshot => {
            const updates = {};
            snapshot.forEach(childSnapshot => {
              updates[childSnapshot.key] = null;
            });
            return database.ref('rooms').update(updates);
          })
          .catch(error => console.warn('Erreur de nettoyage:', error));
      }, 60 * 60 * 1000); // Vérifier toutes les heures
    }
  </script>
</body>
</html>
